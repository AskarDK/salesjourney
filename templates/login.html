{% extends "base.html" %}
{% set title = "–í–æ–π—Ç–∏ ‚Äî Sales Journey" %}
{% block content %}
<section class="max-w-md mx-auto px-4 py-16">
  <div class="rounded-3xl border border-white/10 bg-slate-900/60 p-6 md:p-8 glow">
    <h1 class="text-3xl font-extrabold">–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º üëã</h1>
    <p class="text-slate-300 mt-2">–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ—Ö–æ—Ç—É –∑–∞ –∞—á–∏–≤–∫–∞–º–∏.</p>

    <form id="loginForm" class="space-y-4 mt-6">
      <div>
        <label class="block text-sm mb-1">Email</label>
        <input id="email" name="email" type="email" required
               class="w-full rounded-xl bg-black/40 border border-white/10 px-3 py-2 focus:outline-none focus:ring focus:ring-indigo-500/40">
      </div>
      <div>
        <label class="block text-sm mb-1">–ü–∞—Ä–æ–ª—å</label>
        <input id="password" name="password" type="password" required
               class="w-full rounded-xl bg-black/40 border border-white/10 px-3 py-2 focus:outline-none focus:ring focus:ring-indigo-500/40">
      </div>
      <button type="submit"
              class="w-full rounded-xl bg-indigo-600 hover:bg-indigo-500 py-2 font-semibold transition">
        –í–æ–π—Ç–∏
      </button>
    </form>

    <p class="mt-6 text-sm text-center text-slate-400">
      –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a class="text-indigo-400 hover:underline" href="/register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
    </p>
  </div>
</section>

<script>
document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!email || !password) {
        alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
        return;
    }

    try {
        const response = await fetch("/api/auth/login", {
    method: "POST",
    headers: {
        "Content-Type": "application/json",
    },
    body: JSON.stringify({ email, password }),
});

        if (!response.ok) {
            const errorText = await response.text();
            console.error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:", errorText);
            alert("–û—à–∏–±–∫–∞: " + errorText);
            return;
        }

        const data = await response.json();
        console.log("–£—Å–ø–µ—Ö:", data);

        // –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω
        if (data.token) {
            localStorage.setItem("token", data.token);
        }

        alert("–í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏!");
        window.location.href = "/"; // —Ä–µ–¥–∏—Ä–µ–∫—Ç
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", error);
        alert("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É");
    }
});
</script>
{% endblock %}
