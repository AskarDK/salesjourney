{% extends "base.html" %}
{% set title = "Админ — панель управления" %}

{% block content %}
<section class="max-w-[1400px] mx-auto px-4 py-6" x-data="adminApp()" x-init="init()">
  <div class="grid grid-cols-12 gap-6">
    <!-- Sidebar -->
    <aside class="col-span-12 lg:col-span-3 rounded-2xl border border-white/10 bg-slate-900/60 p-4">
      <div class="text-xl font-bold mb-3">Админ-навигация</div>
      <nav class="space-y-1">
        <template x-for="it in nav">
          <button @click="section = it.key; loadSection()"
                  class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/5 border border-white/10"
                  :class="section===it.key ? 'bg-white/10 border-white/20' : ''">
            <span x-text="it.label"></span>
          </button>
        </template>
      </nav>

      <div class="mt-6 text-xs text-slate-400">
        Быстрые действия
      </div>
      <div class="mt-2 space-y-2">
        <button class="w-full px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500"
                @click="sync()">⟳ Обновить секцию</button>
        <button class="w-full px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500"
                @click="openModal('createUser')">＋ Создать пользователя</button>
        <button class="w-full px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500"
                @click="openModal('createCompany')">＋ Создать компанию</button>
        <button class="w-full px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500"
                @click="openModal('createCourse')">＋ Глобальный курс</button>
      </div>
    </aside>

    <!-- Content -->
    <main class="col-span-12 lg:col-span-9 space-y-6">
      <!-- USERS -->
      <section x-show="section==='users'" x-cloak class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-xl font-bold">Пользователи</h2>
          <div class="flex gap-2">
            <input x-model="filters.userEmail" placeholder="email…" class="px-3 py-2 rounded-lg bg-black/30 border border-white/10">
            <input x-model="filters.userName" placeholder="имя…" class="px-3 py-2 rounded-lg bg-black/30 border border-white/10">
            <button class="px-3 py-2 rounded-lg border border-white/10 hover:bg-white/5" @click="loadUsers()">Найти</button>
          </div>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="text-slate-400">
              <tr>
                <th class="p-2 text-left">ID</th>
                <th class="p-2 text-left">Имя</th>
                <th class="p-2 text-left">Email</th>
                <th class="p-2 text-left">LVL / XP / Coins</th>
                <th class="p-2 text-left">Компания</th>
                <th class="p-2 text-left">Действия</th>
              </tr>
            </thead>
            <tbody>
              <template x-for="u in users" :key="u.id">
                <tr class="border-t border-white/5">
                  <td class="p-2" x-text="u.id"></td>
                  <td class="p-2" x-text="u.display_name"></td>
                  <td class="p-2" x-text="u.email"></td>
                  <td class="p-2" x-text="`${u.level} / ${u.xp} / ${u.coins}`"></td>
                  <td class="p-2" x-text="u.company || '—'"></td>
                  <td class="p-2 space-x-2">
                    <button class="px-2 py-1 rounded border border-white/10 hover:bg-white/5" @click="openUser(u.id)">Открыть</button>
                    <button class="px-2 py-1 rounded border border-rose-500/40 hover:bg-rose-500/20" @click="removeUser(u.id)">Удалить</button>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </section>

      <!-- COMPANIES -->
      <section x-show="section==='companies'" x-cloak class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-xl font-bold">Компании</h2>
          <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500" @click="openModal('createCompany')">＋ Создать</button>
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <template x-for="c in companies" :key="c.id">
            <div class="rounded-xl border border-white/10 p-3">
              <div class="font-semibold" x-text="c.name"></div>
              <div class="text-slate-400 text-sm">slug: <span x-text="c.slug"></span> • план: <span x-text="c.plan"></span></div>
              <div class="text-slate-400 text-sm">join: <span x-text="c.join_code || '—'"></span></div>
              <div class="mt-2 flex gap-2">
                <button class="px-2 py-1 rounded border border-white/10 hover:bg-white/5" @click="regenJoin(c.id)">Реген код</button>
                <button class="px-2 py-1 rounded border border-white/10 hover:bg-white/5" @click="assignCoursePrompt(c.id)">Назначить курс</button>
                <button class="px-2 py-1 rounded border border-rose-500/40 hover:bg-rose-500/20" @click="removeCompany(c.id)">Удалить</button>
              </div>
            </div>
          </template>
        </div>
      </section>

      <!-- COURSES -->
      <section x-show="section==='courses'" x-cloak class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-xl font-bold">Курсы</h2>
          <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500" @click="openModal('createCourse')">＋ Глобальный курс</button>
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <template x-for="c in courses" :key="c.id">
            <div class="rounded-xl border border-white/10 p-3">
              <div class="font-semibold" x-text="c.title"></div>
              <div class="text-slate-400 text-sm">порог: <span x-text="c.pass_score"></span>% • XP: <span x-text="c.xp_reward"></span></div>
              <div class="text-slate-400 text-sm">scope: <span x-text="c.scope"></span> <template x-if="c.company_id">(<span x-text="c.company_id"></span>)</template></div>
              <div class="mt-2 flex gap-2">
                <button class="px-2 py-1 rounded border border-white/10 hover:bg-white/5" @click="editCourse(c.id)">Редакт.</button>
                <button class="px-2 py-1 rounded border border-rose-500/40 hover:bg-rose-500/20" @click="deleteCourse(c.id)">Удалить</button>
              </div>
            </div>
          </template>
        </div>
      </section>

      <!-- STORE -->
      <section x-show="section==='store'" x-cloak class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-xl font-bold">Магазин</h2>
          <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500" @click="openModal('createStoreItem')">＋ Товар</button>
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <template x-for="i in store" :key="i.id">
            <div class="rounded-xl border border-white/10 p-3">
              <div class="font-semibold" x-text="i.title"></div>
              <div class="text-slate-400 text-sm">тип: <span x-text="i.type"></span> • цена: <span x-text="i.cost_coins"></span> • мин.уров: <span x-text="i.min_level"></span></div>
              <div class="text-slate-400 text-sm">stock: <span x-text="i.stock ?? '∞'"></span></div>
              <div class="mt-2 flex gap-2">
                <button class="px-2 py-1 rounded border border-white/10 hover:bg-white/5" @click="editStoreItem(i)">Редакт.</button>
                <button class="px-2 py-1 rounded border border-rose-500/40 hover:bg-rose-500/20" @click="deleteStoreItem(i.id)">Удалить</button>
              </div>
            </div>
          </template>
        </div>
      </section>

      <!-- AVATARS -->
      <section x-show="section==='avatars'" x-cloak class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-xl font-bold">Аватар-ассеты</h2>
          <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500" @click="openModal('createAvatarItem')">＋ Ассет</button>
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <template x-for="a in avatarItems" :key="a.id">
            <div class="rounded-xl border border-white/10 p-3">
              <div class="font-semibold" x-text="`${a.slot} / ${a.key}`"></div>
              <div class="text-slate-400 text-sm">gender: <span x-text="a.gender"></span> • min_lvl: <span x-text="a.min_level"></span></div>
              <div class="mt-2">
                <button class="px-2 py-1 rounded border border-rose-500/40 hover:bg-rose-500/20" @click="deleteAvatarItem(a.id)">Удалить</button>
              </div>
            </div>
          </template>
        </div>
      </section>

      <!-- ACHIEVEMENTS -->
      <section x-show="section==='achievements'" x-cloak class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-xl font-bold">Ачивки</h2>
          <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500" @click="openModal('createAchievement')">＋ Ачивка</button>
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <template x-for="a in achievements" :key="a.id">
            <div class="rounded-xl border border-white/10 p-3">
              <div class="font-semibold" x-text="`${a.code} — ${a.title}`"></div>
              <div class="text-slate-400 text-sm">XP: <span x-text="a.points"></span> • редкость: <span x-text="a.rarity"></span></div>
              <div class="mt-2">
                <button class="px-2 py-1 rounded border border-rose-500/40 hover:bg-rose-500/20" @click="deleteAchievement(a.id)">Удалить</button>
              </div>
            </div>
          </template>
        </div>
      </section>

      <!-- CONTESTS -->
      <section x-show="section==='contests'" x-cloak class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-xl font-bold">Конкурсы</h2>
          <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500" @click="openModal('createContest')">＋ Конкурс</button>
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <template x-for="c in contests" :key="c.id">
            <div class="rounded-xl border border-white/10 p-3">
              <div class="font-semibold" x-text="c.title"></div>
              <div class="text-slate-400 text-sm">
                <span x-text="c.start_at.slice(0,10)"></span> — <span x-text="c.end_at.slice(0,10)"></span>
              </div>
              <div class="mt-2">
                <button class="px-2 py-1 rounded border border-rose-500/40 hover:bg-rose-500/20" @click="deleteContest(c.id)">Удалить</button>
              </div>
            </div>
          </template>
        </div>
      </section>

      <!-- AUDIT -->
      <section x-show="section==='audit'" x-cloak class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
        <h2 class="text-xl font-bold mb-3">Аудит/античит</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="text-slate-400">
              <tr><th class="p-2 text-left">ID</th><th class="p-2 text-left">user</th><th class="p-2 text-left">type</th><th class="p-2 text-left">signal</th><th class="p-2 text-left">score</th><th class="p-2 text-left">at</th></tr>
            </thead>
            <tbody>
              <template x-for="a in audit" :key="a.id">
                <tr class="border-t border-white/5">
                  <td class="p-2" x-text="a.id"></td>
                  <td class="p-2" x-text="a.user_id"></td>
                  <td class="p-2" x-text="a.type"></td>
                  <td class="p-2" x-text="a.signal || '—'"></td>
                  <td class="p-2" x-text="a.score"></td>
                  <td class="p-2" x-text="a.created_at"></td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </section>

      <!-- SCORE EVENTS -->
      <section x-show="section==='events'" x-cloak class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-xl font-bold">События (XP/coins)</h2>
          <div class="flex gap-2">
            <input x-model.number="filters.eventsUserId" placeholder="user_id…" class="px-3 py-2 rounded-lg bg-black/30 border border-white/10">
            <button class="px-3 py-2 rounded-lg border border-white/10 hover:bg-white/5" @click="loadEvents()">Загрузить</button>
          </div>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="text-slate-400">
              <tr><th class="p-2 text-left">ID</th><th class="p-2 text-left">user</th><th class="p-2 text-left">source</th><th class="p-2 text-left">points</th><th class="p-2 text-left">coins</th><th class="p-2 text-left">meta</th><th class="p-2 text-left">at</th></tr>
            </thead>
            <tbody>
              <template x-for="e in events" :key="e.id">
                <tr class="border-t border-white/5">
                  <td class="p-2" x-text="e.id"></td>
                  <td class="p-2" x-text="e.user_id"></td>
                  <td class="p-2" x-text="e.source"></td>
                  <td class="p-2" x-text="e.points"></td>
                  <td class="p-2" x-text="e.coins"></td>
                  <td class="p-2" x-text="JSON.stringify(e.meta)"></td>
                  <td class="p-2" x-text="e.created_at"></td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <!-- МОДАЛКИ -->
  <div x-show="modal==='createUser'" x-transition class="fixed inset-0 bg-black/60 backdrop-blur-sm grid place-items-center p-4 z-50">
    <form @submit.prevent="createUser" class="w-full max-w-md rounded-2xl border border-white/10 bg-slate-900/95 p-4 space-y-3">
      <div class="text-xl font-bold">Создать пользователя</div>
      <input x-model="forms.user.email" placeholder="email" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model="forms.user.password" placeholder="пароль" type="password" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model="forms.user.display_name" placeholder="имя" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <select x-model="forms.user.gender" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
        <option value="">gender (опц.)</option>
        <option>male</option><option>female</option><option>other</option>
      </select>
      <div class="flex gap-2 justify-end">
        <button type="button" class="px-3 py-2 rounded-lg border border-white/10 hover:bg-white/5" @click="closeModal()">Отмена</button>
        <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500">Создать</button>
      </div>
    </form>
  </div>

  <div x-show="modal==='createCompany'" x-transition class="fixed inset-0 bg-black/60 backdrop-blur-sm grid place-items-center p-4 z-50">
    <form @submit.prevent="createCompany" class="w-full max-w-md rounded-2xl border border-white/10 bg-slate-900/95 p-4 space-y-3">
      <div class="text-xl font-bold">Создать компанию</div>
      <input x-model="forms.company.name" placeholder="Название" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model="forms.company.slug" placeholder="slug" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <select x-model="forms.company.plan" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
        <option value="starter">starter</option><option value="pro">pro</option><option value="enterprise">enterprise</option>
      </select>
      <div class="flex gap-2 justify-end">
        <button type="button" class="px-3 py-2 rounded-lg border border-white/10 hover:bg-white/5" @click="closeModal()">Отмена</button>
        <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500">Создать</button>
      </div>
    </form>
  </div>

<div x-show="modal==='createCourse'" x-transition
     class="fixed inset-0 bg-black/60 backdrop-blur-sm grid place-items-center p-4 z-50">
  <form @submit.prevent="createCourse"
        class="w-full max-w-3xl rounded-2xl border border-white/10 bg-slate-900/95 p-0 overflow-hidden">
    <div class="px-5 py-4 border-b border-white/10 flex items-center justify-between">
      <div class="text-xl font-bold">Глобальный курс</div>
      <button type="button" class="text-slate-300 hover:text-white" @click="closeModal()">✕</button>
    </div>

    <div id="createCourseScroll" class="max-h-[80vh] overflow-auto p-5 space-y-4">
      <input x-model="forms.course.title" placeholder="Заголовок"
             class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <textarea x-model="forms.course.content_md" rows="6" placeholder="Markdown-контент"
             class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10"></textarea>
      <input x-model="forms.course.youtube_url" placeholder="YouTube URL (опц.)"
             class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <div class="grid grid-cols-3 gap-2">
        <input x-model.number="forms.course.pass_score" type="number" min="0" max="100" class="px-3 py-2 rounded-lg bg-black/30 border border-white/10" placeholder="Порог %">
        <input x-model.number="forms.course.max_attempts" type="number" min="1" class="px-3 py-2 rounded-lg bg-black/30 border border-white/10" placeholder="Попыток">
        <input x-model.number="forms.course.xp_reward" type="number" min="0" class="px-3 py-2 rounded-lg bg-black/30 border border-white/10" placeholder="XP">
      </div>

      <!-- ВОПРОСЫ -->
      <div class="space-y-3">
        <template x-for="(q, qi) in forms.course.questions" :key="qi">
          <div class="rounded-xl border border-white/10 bg-black/30 p-3 space-y-2">
            <div class="flex items-center gap-2">
              <input x-model="q.text" class="flex-1 px-3 py-2 rounded-lg bg-black/30 border border-white/10" placeholder="Текст вопроса">
              <button type="button" class="px-3 py-2 rounded-lg border border-white/10 hover:bg-white/5" @click="removeQuestion(qi)">Удалить</button>
            </div>
            <div class="pl-3 space-y-2">
              <template x-for="(o, oi) in (q.options || [])" :key="oi">
                <div class="flex items-center gap-2">
                  <input type="radio" :name="'q_'+qi" x-model="o.is_correct" :value="true" @change="q.options.forEach((x,idx)=>x.is_correct=(idx===oi))">
                  <input x-model="o.text" class="flex-1 px-3 py-1.5 rounded-lg bg-black/30 border border-white/10" placeholder="Вариант">
                  <button type="button" class="px-2 py-1 rounded-lg border border-white/10 hover:bg-white/5" @click="removeOption(qi, oi)">✕</button>
                </div>
              </template>
              <button type="button" class="px-3 py-1.5 rounded-lg border border-white/10 hover:bg-white/5" @click="addOption(qi)">+ Вариант</button>
            </div>
          </div>
        </template>

        <button type="button" @click="addQuestion()" class="mt-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg">
          + Добавить вопрос
        </button>
      </div>
    </div>

    <div class="px-5 py-4 border-t border-white/10 flex justify-end gap-2">
      <button type="button" class="px-3 py-2 rounded-lg border border-white/10 hover:bg-white/5" @click="closeModal()">Отмена</button>
      <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500">Создать</button>
    </div>
  </form>
</div>



  <div x-show="modal==='createStoreItem'" x-transition class="fixed inset-0 bg-black/60 backdrop-blur-sm grid place-items-center p-4 z-50">
    <form @submit.prevent="createStoreItem" class="w-full max-w-md rounded-2xl border border-white/10 bg-slate-900/95 p-4 space-y-3">
      <div class="text-xl font-bold">Товар магазина</div>
      <select x-model="forms.store.type" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
        <option value="skin">skin</option><option value="coupon">coupon</option><option value="merch">merch</option>
      </select>
      <input x-model="forms.store.title" placeholder="Название" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model.number="forms.store.cost_coins" type="number" placeholder="Цена в коинс" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model.number="forms.store.min_level" type="number" placeholder="Мин. уровень" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model="forms.store.stock" placeholder="stock (пусто = ∞)" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <textarea x-model="forms.store.payload" rows="4" placeholder='JSON payload, напр. {"slot":"frame","key":"frame_gold","auto_equip":true}' class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10"></textarea>
      <div class="flex gap-2 justify-end">
        <button type="button" class="px-3 py-2 rounded-lg border border-white/10 hover:bg-white/5" @click="closeModal()">Отмена</button>
        <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500">Создать</button>
      </div>
    </form>
  </div>

  <div x-show="modal==='createAvatarItem'" x-transition class="fixed inset-0 bg-black/60 backdrop-blur-sm grid place-items-center p-4 z-50">
    <form @submit.prevent="createAvatarItem" class="w-full max-w-md rounded-2xl border border-white/10 bg-slate-900/95 p-4 space-y-3">
      <div class="text-xl font-bold">Ассет аватара</div>
      <input x-model="forms.avatar.slot" placeholder="slot (hair/outfit/frame/...)" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model="forms.avatar.key" placeholder="key" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <select x-model="forms.avatar.gender" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
        <option value="any">any</option><option>male</option><option>female</option>
      </select>
      <input x-model.number="forms.avatar.min_level" type="number" placeholder="min_level" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model="forms.avatar.asset_url" placeholder="asset_url (опц.)" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <div class="flex gap-2 justify-end">
        <button type="button" class="px-3 py-2 rounded-lg border border-white/10 hover:bg-white/5" @click="closeModal()">Отмена</button>
        <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500">Создать</button>
      </div>
    </form>
  </div>

  <div x-show="modal==='createAchievement'" x-transition class="fixed inset-0 bg-black/60 backdrop-blur-sm grid place-items-center p-4 z-50">
    <form @submit.prevent="createAchievement" class="w-full max-w-md rounded-2xl border border-white/10 bg-slate-900/95 p-4 space-y-3">
      <div class="text-xl font-bold">Новая ачивка</div>
      <input x-model="forms.ach.code" placeholder="CODE" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model="forms.ach.title" placeholder="Заголовок" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model.number="forms.ach.points" type="number" placeholder="XP" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model="forms.ach.rarity" placeholder="rarity (common/uncommon/rare)" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <textarea x-model="forms.ach.description" rows="3" placeholder="Описание" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10"></textarea>
      <div class="flex gap-2 justify-end">
        <button type="button" class="px-3 py-2 rounded-lg border border-white/10 hover:bg-white/5" @click="closeModal()">Отмена</button>
        <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500">Создать</button>
      </div>
    </form>
  </div>

  <div x-show="modal==='createContest'" x-transition class="fixed inset-0 bg-black/60 backdrop-blur-sm grid place-items-center p-4 z-50">
    <form @submit.prevent="createContest" class="w-full max-w-md rounded-2xl border border-white/10 bg-slate-900/95 p-4 space-y-3">
      <div class="text-xl font-bold">Новый конкурс</div>
      <input x-model="forms.contest.title" placeholder="Заголовок" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model="forms.contest.start_at" type="datetime-local" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model="forms.contest.end_at" type="datetime-local" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model="forms.contest.prize" placeholder="Приз (опц.)" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <input x-model="forms.contest.min_rating" type="number" placeholder="Мин.уровень (опц.)" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-white/10">
      <label class="flex items-center gap-2 text-sm">
        <input type="checkbox" x-model="forms.contest.is_company_only"> только для компании (укажешь company_id в API при необходимости)
      </label>
      <div class="flex gap-2 justify-end">
        <button type="button" class="px-3 py-2 rounded-lg border border-white/10 hover:bg-white/5" @click="closeModal()">Отмена</button>
        <button class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500">Создать</button>
      </div>
    </form>
  </div>

</section>
{% endblock %}

{% block scripts %}
<!-- Alpine обязательно до admin.js -->
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script defer src="{{ url_for('static', filename='admin.js') }}"></script>
{% endblock %}
